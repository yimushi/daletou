<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>北京11选5历史号码开奖展示</title>
    <link rel="stylesheet" href="./css/public.css">
    <link rel="stylesheet" href="./css/default.css">
    <link rel="stylesheet" href="./css/style.css">
    <link rel="stylesheet" href="./css/115.css">
</head>
<body style="-webkit-transform: rotate(270deg);
-moz-transform: rotate(270deg);
-o-transform: rotate(270deg);
-ms-transform: rotate(270deg);
transform: rotate(270deg); ">
    <div id="app115" v-cloak >
        <div class="ad">
            <img src="./css/b.jpg" alt="">
        </div>
        <div id="app">
            <div class="header_top">
                <div class="one">第<span style="font-weight: bold;" v-text="qi"></span>期</div>
                <div class="two">北京11选5历史号码开奖展示</div>
                <div class="tre">距离止售:<span id="newqi" style="font-weight: bold;">11:29</span></div>
            </div>
            <div id="trend" style="height: calc(100% - 27px);">
                <div id="elec_table">
                    <div class="table-body">
                        <table cellpadding="0" cellspacing="1" class="tabtrend115" id="tabtrend">
                            <thead>
                                <tr>
                                    <td rowspan="2" width="15">期号</td>
                                    <td rowspan="2" colspan="5">开奖顺序</td>
                                    <td colspan="11">开奖号码</td>

                                </tr>
                                <tr>
                                    <td>1</td>
                                    <td>2</td>
                                    <td>3</td>
                                    <td>4</td>
                                    <td>5</td>
                                    <td>6</td>
                                    <td>7</td>
                                    <td>8</td>
                                    <td>9</td>
                                    <td>10</td>
                                    <td>11</td>
                                </tr>
                            </thead>
                            <tbody id="tobdd">
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
</body>
<script src="./js/zepto.min.js"></script>
<script type="text/javascript">
    var qi = "",
        data1 = [],
        number = {
            qh: 0,
            prizeNumber: 0,
            otherNumbers: []
        },
        colorData = {},
        lastData = null;
    initPreData();
    getData();
    // setInterval(function(){
    //     getData()
    // }, 5000);
    var html = ""

    function addhtml(list) {
        list.forEach(function (item, index) {
            html += "<tr>" + "<td>" + item.qh + "</td>" +
                "<td class='red'>" + item.prizeNumber[0] + "</td>" +
                "<td  class='red'>" + item.prizeNumber[1] + "</td>" +
                "<td  class='red'>" + item.prizeNumber[2] + "</td>" +
                "<td class='colorblue'>" + item.prizeNumber[3] + "</td>" +
                "<td class='colorblue'>" + item.prizeNumber[4] + "</td>" +
                "<td class=" + classVal(item.otherNumbers[0]) + " >" + show(item.otherNumbers[0]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[1]) + " >" + show(item.otherNumbers[1]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[2]) + " >" + show(item.otherNumbers[2]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[3]) + " >" + show(item.otherNumbers[3]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[4]) + " >" + show(item.otherNumbers[4]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[5]) + " >" + show(item.otherNumbers[5]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[6]) + " >" + show(item.otherNumbers[6]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[7]) + " >" + show(item.otherNumbers[7]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[8]) + " >" + show(item.otherNumbers[8]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[9]) + " >" + show(item.otherNumbers[9]) + "</td>" +
                "<td class=" + classVal(item.otherNumbers[10]) + " >" + show(item.otherNumbers[10]) + "</td>" +
                "<tr>";
        });
        $("#tobdd").html(html)
    }

    function show(val) {
        return val.display ? val.value : val.forget;
    }

    function classVal(val) {
        var str = "";
        if (val.display && val.color === "") {
            str = "blue"
        }
        if (val.display && val.color === "red") {
            str = 'red';
        }
        return str;
    }

    function getData() {
        $.ajax({
            url: "http://139.9.248.208:9090/openapi/winaward/11x5",
            dataType: "json",
            success: function (res) {
                $("#anc").text("ajaxajax");
                dealData(res.data);
                colorData = sort(res.data);
                lastData = addcolor();
                addhtml(lastData);
            }
        })
    };

    function initPreData() {
        for (var i = 1; i < 12; i++) {
            number.otherNumbers.push({
                value: i,
                forget: 0,
                display: false,
                color: ""
            });
        }
    };

    function dealData(data) {
        qi = Number(data[data.length - 1].qh) + 1;
        for (var j = 0; j < data.length; j++) {
            var item = data[j];
            number.qh = item.qh.slice(-2);
            var allPrizeNumbers = item.numbers.split(',')
            number.prizeNumber = allPrizeNumbers;
            for (var k = 0; k < allPrizeNumbers.length; k++) {
                var prizeNumber = allPrizeNumbers[k]
                for (var i = 0; i < number.otherNumbers.length; i++) {
                    var otherNumber = number.otherNumbers[i];
                    if (otherNumber.value == prizeNumber) {
                        otherNumber.display = true;
                        otherNumber.forget = 0;
                        break;
                    }
                }
            }

            for (var h = 0; h < number.otherNumbers.length; h++) {
                var otherNumber = number.otherNumbers[h];
                if (!otherNumber.display) {
                    otherNumber.forget += 1;
                }
            }
            var cloneData = deepClone(number);
            for (var b = 0; b < number.otherNumbers.length; b++) {
                var otherNumber = number.otherNumbers[b];
                if (otherNumber.display) {
                    otherNumber.display = false;
                }
            }
            data1.push(cloneData);
        };
    };

    function deepClone(obj) {
        if (typeof obj == null || typeof obj != 'object') return obj;
        var res = null;
        if (typeof obj === 'object') {
            res = {};
            for (var key in obj) {
                res[key] = deepClone(obj[key]);
            }
        } else if (Array.isArray(obj)) {
            res = [];
            for (var i = 0; i < obj.length; i++) {
                res.push(deepClone(obj[i]));
            }
        } else {
            res = obj;
        }
        return res;
    };

    function addcolor() {
        var datalist = data1;
        for (var index in colorData) {
            var cur = colorData[index];
            console.log(index, cur);
            var dataItem = datalist[index].otherNumbers;
            for (var inde in dataItem) {
                var curData = dataItem[inde];
                for (var i = 0; i < cur.length; i++) {
                    if (curData.value == cur[i]) {
                        curData.color = "red";
                    }
                }
            }

        }
        $("#number").text("0055" + number);

        console.log("red", datalist);
        return datalist;
    };

    function sort(data) {
        var ary = [],
            lineAry = {};

        for (var i = 0; i < data.length; i++) { //将每期中奖号码有小到大排序
            var item = data[i];
            var numbers = item.numbers.split(',');
            var nums = [];
            for (var j = 0; j < numbers.length; j++) {
                nums.push(Number(numbers[j]))
            }
            var min;
            for (var u = 0; u < nums.length; u++) {
                for (var j = u; j < nums.length; j++) {
                    if (nums[u] > nums[j]) {
                        min = nums[j];
                        nums[j] = nums[u];
                        nums[u] = min;
                    }
                }
            }
            ary.push(nums)
        }

        for (var v = 0; v < ary.length; v++) {
            var inde = v;
            var item = ary[v];
            var arr = lianxu(item);
            if (arr.length === 5) {
                if (ou(arr) || ji(arr)) {
                    lineAry[inde] = arr;
                }
            } else {
                for (var i = 0; i < arr.length; i++) {
                    if (arr[i].length > 2) {
                        lineAry[inde] = arr[i];
                    }
                }
            }
        }

        return lineAry;
    };

    function lianxu(arr) { //获取连续的数字
        var result = [],
            i = 0;
        result[i] = [arr[0]];
        arr.reduce(function (prev, cur) {
            cur - prev === 1 ? result[i].push(cur) : result[++i] = [cur];
            return cur;
        });
        return result;
    };

    function ou(ary) { //全部偶数
        var flag = true;
        for (var d = 0; d < ary.length; d++) {
            var item = ary[d];
            if (item[0] % 2 === 1) {
                flag = false;
            }
        }
        return flag;
    };

    function ji(ary) { //全部奇数
        var flag = true;
        for (var d = 0; d < ary.length; d++) {
            var item = ary[d];
            if (item[0] % 2 === 0) {
                flag = false;
            }
        }
        return flag;
    };
</script>


</html>